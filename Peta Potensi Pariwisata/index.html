<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta
      name="viewport"
      content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width"
    >
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- CSS bawaan qgis2web + plugin -->
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="css/leaflet.photon.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">

    <!-- Reset dasar -->
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
      }
    </style>

    <title>Peta Potensi Pariwisata Kabupaten Kulon Progo</title>
    
    <!-- CSS Custom untuk Search Box -->
    <style>
      /* Search Box */
      .search-container {
        position: absolute;
        top: 80px;
        right: 20px;
        z-index: 1000;
        width: 280px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
      
      .search-header {
        padding: 12px 15px;
        background: #e8f2fa;
        color: #000000;
        border-radius: 8px 8px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .search-header h3 {
        margin: 0;
        font-size: 14px;
        font-weight: 600;
      }
      
      .search-close {
        background: none;
        border: none;
        color: #000000;
        font-size: 18px;
        cursor: pointer;
        line-height: 1;
        padding: 0;
        width: 20px;
        height: 20px;
      }
      
      .search-input-container {
        padding: 15px;
        border-bottom: 1px solid #eee;
      }
      
      .search-input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }
      
      .search-input:focus {
        outline: none;
        border-color: #2a5298;
        box-shadow: 0 0 0 2px rgba(42, 82, 152, 0.1);
      }
      
      .search-results {
        max-height: 300px;
        overflow-y: auto;
      }
      
      .search-result-item {
        padding: 10px 15px;
        border-bottom: 1px solid #f0f0f0;
        cursor: pointer;
        font-size: 13px;
        transition: background 0.2s;
      }
      
      .search-result-item:hover {
        background: #f8f9fa;
      }
      
      .search-result-item.active {
        background: #e8f2fa;
        border-left: 3px solid #2a5298;
      }
      
      .result-name {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 3px;
      }
      
      .result-details {
        display: flex;
        justify-content: space-between;
        color: #666;
        font-size: 11px;
      }
      
      .result-type {
        background: #e9ecef;
        padding: 2px 6px;
        border-radius: 3px;
        color: #495057;
      }
      
      .no-results {
        padding: 20px 15px;
        text-align: center;
        color: #666;
        font-size: 13px;
      }
      
      .search-toggle {
        position: absolute;
        top: 80px;
        right: 20px;
        z-index: 1000;
        background: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        cursor: pointer;
        color: #000000;
        font-size: 16px;
      }
      
      .search-toggle:hover {
        background: #f8f9fa;
      }
    </style>
  </head>

  <body>

    <!-- HEADER CUSTOM -->
    <div id="custom-header">
      <div class="header-left">
        <img src="images/transp.png" id="header-logo" alt="Logo">
        <div class="header-title">
          <h1>PETA POTENSI PARIWISATA KABUPATEN KULON PROGO</h1>
        </div>
      </div>
      <div class="header-right">
        <h2>Tahun 2025</h2>
      </div>
    </div>

    <!-- PANEL INSTRUKSI -->
    <div id="instruksi-layer" style="
      display:none;
      position:absolute;
      top:78px;
      left:calc(260px + (100% - 260px)/2);
      transform:translateX(-50%);
      background:#f5f5f5ee;
      padding:8px 14px;
      border-radius:8px;
      box-shadow:0 2px 6px rgba(0,0,0,0.18);
      font-size:13px;
      font-family:'Inter', sans-serif;
      color:#333;
      border:1px solid #dddddd;
      z-index:9999;
      align-items:center;
      gap:8px;
    ">
      <span id="instruksi-text">
        Klik wilayah kecamatan atau destinasi wisata untuk melihat informasi.
      </span>
      <button id="instruksi-close" style="
        border:none;
        background:transparent;
        font-size:16px;
        line-height:1;
        cursor:pointer;
        color:#555;
        padding:0 2px;
      ">
        ×
      </button>
    </div>

    <!-- SEARCH TOGGLE BUTTON -->
    <button id="searchToggle" class="search-toggle">
      <i class="fas fa-search"></i>
    </button>

    <!-- SEARCH CONTAINER -->
    <div id="searchContainer" class="search-container" style="display: none;">
      <div class="search-header">
        <h3>CARI DESTINASI WISATA</h3>
        <button id="closeSearch" class="search-close">×</button>
      </div>
      <div class="search-input-container">
        <input 
          type="text" 
          id="searchInput" 
          class="search-input" 
          placeholder="Masukkan nama destinasi wisata..."
          autocomplete="off"
        >
      </div>
      <div id="searchResults" class="search-results">
        <!-- Hasil pencarian akan muncul di sini -->
      </div>
    </div>

    <!-- PANEL INFORMASI -->
    <div id="panel-info" style="
      display:none;
      position:absolute;
      right:0;
      top:70px;
      width:260px;
      height:calc(100% - 78px);
      background:white;
      padding:16px 18px;
      box-shadow:-2px 0 5px rgba(0,0,0,0.2);
      z-index:9999;
      overflow-y:auto;
    ">
      <div class="panel-info-header">
        <span class="panel-info-title">INFORMASI</span>
        <button class="panel-info-close" onclick="tutupPanel()">×</button>
      </div>
      <div id="isi-panel-info" style="
        margin-top:10px;
        font-size:13px;
        font-family:'Inter',sans-serif;
        color:#333;
      "></div>
    </div>

    <!-- SIDEBAR KIRI -->
<div id="sidebar">
  <div class="section-title">
    <img src="images/layerr.png">
    <span>Layer</span>
  </div>
  
  <!-- Jaringan Jalan -->
  <label>
    <input type="checkbox" id="cb_jalan">
    Jaringan Jalan
  </label>
  
  
  <!-- Jenis Wisata (Group) -->
  <div style="margin-left: 15px;">
    <label>
      <input type="checkbox" id="cb_jeniswisata">
      Jenis Wisata
    </label>
    
    <!-- Sub-checkbox untuk jenis wisata -->
    <div id="sub-jeniswisata" style="margin-left: 20px; display: none;">
      <label>
        <input type="checkbox" id="cb_desawisata">
        Desa Wisata
      </label>
      
      <label>
        <input type="checkbox" id="cb_wisataalam">
        Wisata Alam
      </label>
      
      <label>
        <input type="checkbox" id="cb_wisatabahari">
        Wisata Bahari
      </label>
      
      <label>
        <input type="checkbox" id="cb_wisatabuatan">
        Wisata Buatan
      </label>
      
      <label>
        <input type="checkbox" id="cb_wisataminat">
        Wisata Minat Khusus
      </label>
      
      <label>
        <input type="checkbox" id="cb_wisatabudaya">
        Wisata Budaya
      </label>
    </div>
  </div>
  
  <!-- Aksesibilitas Wisata -->
  <label>
    <input type="checkbox" id="cb_akses">
    Aksesibilitas Wisata
  </label>
  
  <!-- Jumlah Destinasi Wisata -->
  <label>
    <input type="checkbox" id="cb_jumlahwisata">
    Jumlah Destinasi Wisata
  </label>
  
  <!-- LEGENDA -->
  <div class="section-title">
    <img src="images/legenda.png">
    <span>Legenda</span>
  </div>
  
  <!-- Container Legenda -->
  
  <!-- Legenda Jaringan Jalan -->
  <div id="leg_jalan" style="display:none; margin-bottom:1px;">
  <div class="legend-box">
    <div class="legend-title-inside">Jaringan Jalan</div>
    <div class="legend-item">
      <span class="legend-color" style="background:#909090; height:1.5px;"></span>
      <span>Jalan</span>
    </div>
  </div>
</div>
  
  <!-- Legenda Desa Wisata -->
  <div id="leg_desawisata" style="display:none; margin-bottom:8px;">
    <div class="legend-box">
      <div class="legend-title-inside">Desa Wisata</div>
      
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/DesaWisata_9_TidakPopuler0.png" alt="Tidak Populer">
        </span>
        <span>Tidak Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/DesaWisata_9_KurangPopuler1.png" alt="Kurang Populer">
        </span>
        <span>Kurang Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/DesaWisata_9_CukupPopuler2.png" alt="Cukup Populer">
        </span>
        <span>Cukup Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/DesaWisata_9_Populer3.png" alt="Populer">
        </span>
        <span>Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/DesaWisata_9_SangatPopuler4.png" alt="Sangat Populer">
        </span>
        <span>Sangat Populer</span>
      </div>
    </div>
  </div>
  
  <!-- Legenda Wisata Alam -->
  <div id="leg_wisataalam" style="display:none; margin-bottom:8px;">
    <div class="legend-box">
      <div class="legend-title-inside">Wisata Alam</div>
      
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataAlam_8_TidakPopuler0.png" alt="Tidak Populer">
        </span>
        <span>Tidak Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataAlam_8_KurangPopuler1.png" alt="Kurang Populer">
        </span>
        <span>Kurang Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataAlam_8_CukupPopuler2.png" alt="Cukup Populer">
        </span>
        <span>Cukup Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataAlam_8_Populer3.png" alt="Populer">
        </span>
        <span>Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataAlam_8_SangatPopuler4.png" alt="Sangat Populer">
        </span>
        <span>Sangat Populer</span>
      </div>
    </div>
  </div>
  
  <!-- Legenda Wisata Bahari -->
  <div id="leg_wisatabahari" style="display:none; margin-bottom:8px;">
    <div class="legend-box">
      <div class="legend-title-inside">Wisata Bahari</div>
      
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBahari_7_TidakPopuler0.png" alt="Tidak Populer">
        </span>
        <span>Tidak Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBahari_7_KurangPopuler1.png" alt="Kurang Populer">
        </span>
        <span>Kurang Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBahari_7_CukupPopuler2.png" alt="Cukup Populer">
        </span>
        <span>Cukup Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBahari_7_Populer3.png" alt="Populer">
        </span>
        <span>Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBahari_7_SangatPopuler4.png" alt="Sangat Populer">
        </span>
        <span>Sangat Populer</span>
      </div>
    </div>
  </div>
  
  <!-- Legenda Wisata Buatan -->
  <div id="leg_wisatabuatan" style="display:none; margin-bottom:8px;">
    <div class="legend-box">
      <div class="legend-title-inside">Wisata Buatan</div>
      
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBuatan_6_TidakPopuler0.png" alt="Tidak Populer">
        </span>
        <span>Tidak Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBuatan_6_KurangPopuler1.png" alt="Kurang Populer">
        </span>
        <span>Kurang Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBuatan_6_CukupPopuler2.png" alt="Cukup Populer">
        </span>
        <span>Cukup Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBuatan_6_Populer3.png" alt="Populer">
        </span>
        <span>Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBuatan_6_SangatPopuler4.png" alt="Sangat Populer">
        </span>
        <span>Sangat Populer</span>
      </div>
    </div>
  </div>
  
  <!-- Legenda Wisata Budaya -->
  <div id="leg_wisatabudaya" style="display:none; margin-bottom:8px;">
    <div class="legend-box">
      <div class="legend-title-inside">Wisata Budaya</div>
      
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBudaya_5_TidakPopuler0.png" alt="Tidak Populer">
        </span>
        <span>Tidak Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBudaya_5_KurangPopuler1.png" alt="Kurang Populer">
        </span>
        <span>Kurang Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBudaya_5_CukupPopuler2.png" alt="Cukup Populer">
        </span>
        <span>Cukup Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBudaya_5_Populer3.png" alt="Populer">
        </span>
        <span>Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataBudaya_5_SangatPopuler4.png" alt="Sangat Populer">
        </span>
        <span>Sangat Populer</span>
      </div>
    </div>
  </div>
  
  <!-- Legenda Wisata Minat Khusus -->
  <div id="leg_wisataminat" style="display:none; margin-bottom:8px;">
    <div class="legend-box">
      <div class="legend-title-inside">Wisata Minat Khusus</div>
      
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataMinat_4_01580.png" alt="0 - 158">
        </span>
        <span>Tidak Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataMinat_4_1584421.png" alt="158 - 442">
        </span>
        <span>Kurang Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataMinat_4_44213932.png" alt="442 - 1393">
        </span>
        <span>Cukup Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataMinat_4_139356623.png" alt="1393 - 5662">
        </span>
        <span>Populer</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/WisataMinat_4_5662446174.png" alt="5662 - 44617">
        </span>
        <span>Sangat Populer</span>
      </div>
    </div>
  </div>
  
  <!-- Legenda Aksesibilitas Wisata -->
  <div id="leg_akses" style="display:none; margin-bottom:8px;">
    <div class="legend-box">
      <div class="legend-title-inside">Tingkat Aksesibilitas</div>
      
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/Aksesibilitas_2_Rendah0.png" alt="Rendah">
        </span>
        <span>Rendah</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/Aksesibilitas_2_Sedang1.png" alt="Sedang">
        </span>
        <span>Sedang</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/Aksesibilitas_2_Tinggi2.png" alt="Tinggi">
        </span>
        <span>Tinggi</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/Aksesibilitas_2_SangatTinggi3.png" alt="Sangat Tinggi">
        </span>
        <span>Sangat Tinggi</span>
      </div>
    </div>
  </div>
  
  <!-- Legenda Jumlah Destinasi Wisata -->
  <div id="leg_jumlahwisata" style="display:none; margin-bottom:8px;">
    <div class="legend-box">
      <div class="legend-title-inside">Jumlah Destinasi Wisata</div>
      
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/JumlahDestinasiWisata_1_240.png" alt="2 - 4">
        </span>
        <span>2 - 4</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/JumlahDestinasiWisata_1_461.png" alt="4 - 6">
        </span>
        <span>4 - 6</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/JumlahDestinasiWisata_1_692.png" alt="6 - 9">
        </span>
        <span>6 - 9</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/JumlahDestinasiWisata_1_9163.png" alt="9 - 16">
        </span>
        <span>9 - 16</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon">
          <img src="legend/JumlahDestinasiWisata_1_16214.png" alt="16 - 21">
        </span>
        <span>16 - 21</span>
      </div>
    </div>
  </div>
</div>

    <!-- KANVAS PETA -->
    <div id="map"></div>
    
    <!-- FOOTER INFORMASI SUMBER DATA -->
    <div id="data-source-footer" style="
      position: absolute;
      bottom: 0;
      left: 260px;
      right: 0;
      height: 25px;
      background: rgba(255, 255, 255, 0.9);
      border-top: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 11px;
      color: #555;
      transition: left 0.25s ease, right 0.25s ease;
    ">
      <span>Data yang digunakan dari Badan Pusat Statistik tahun 2024</span>
    </div>

    <!-- JS LIBRARIES -->
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Layers.Tree.min.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/leaflet.photon.js"></script>
    <script src="js/leaflet-measure.js"></script>

    <!-- DATA LAYER -->
    <script src="data/JumlahDestinasiWisata_1.js"></script>
    <script src="data/Aksesibilitas_2.js"></script>
    <script src="data/Jalan_3.js"></script>
    <script src="data/WisataMinat_4.js"></script>
    <script src="data/WisataBudaya_5.js"></script>
    <script src="data/WisataBuatan_6.js"></script>
    <script src="data/WisataBahari_7.js"></script>
    <script src="data/WisataAlam_8.js"></script>
    <script src="data/DesaWisata_9.js"></script>

    <!-- SCRIPT PETA -->
    <script>
      // Variabel global untuk pencarian
      var searchIndex = [];
      var allWisataLayers = [];
      var searchVisible = false;
      
      var highlightLayer;
      
      function highlightFeature(e) {
        highlightLayer = e.target;

        if (
          e.target.feature.geometry.type === "LineString" ||
          e.target.feature.geometry.type === "MultiLineString"
        ) {
          highlightLayer.setStyle({
            color: "#ffff00",
          });
        } else {
          highlightLayer.setStyle({
            fillColor: "#ffff00",
            fillOpacity: 1,
          });
        }
        highlightLayer.openPopup();
      }

      var map = L.map("map", {
        zoomControl: false,
        maxZoom: 28,
        minZoom: 1,
      });

      var hash = new L.Hash(map);
      map.attributionControl.setPrefix(
        '<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; ' +
          '<a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; ' +
          '<a href="https://qgis.org">QGIS</a>'
      );

      var autolinker = new Autolinker({
        truncate: { length: 30, location: "smart" },
      });

      // remove popup's row if "visible-with-data"
      function removeEmptyRowsFromPopupContent(content, feature) {
        var tempDiv = document.createElement("div");
        tempDiv.innerHTML = content;
        var rows = tempDiv.querySelectorAll("tr");
        for (var i = 0; i < rows.length; i++) {
          var td = rows[i].querySelector("td.visible-with-data");
          var key = td ? td.id : "";
          if (
            td &&
            td.classList.contains("visible-with-data") &&
            feature.properties[key] == null
          ) {
            rows[i].parentNode.removeChild(rows[i]);
          }
        }
        return tempDiv.innerHTML;
      }

      // modify popup if contains media
      function addClassToPopupIfMedia(content, popup) {
        var tempDiv = document.createElement("div");
        tempDiv.innerHTML = content;
        var imgTd = tempDiv.querySelector("td img");
        if (imgTd) {
          var src = imgTd.getAttribute("src");
          if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
            popup._contentNode.classList.add("media");
            setTimeout(function () {
              popup.update();
            }, 10);
          } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
            var audio = document.createElement("audio");
            audio.controls = true;
            audio.src = src;
            imgTd.parentNode.replaceChild(audio, imgTd);
            popup._contentNode.classList.add("media");
            setTimeout(function () {
              popup.setContent(tempDiv.innerHTML);
              popup.update();
            }, 10);
          } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
            var video = document.createElement("video");
            video.controls = true;
            video.src = src;
            video.style.width = "400px";
            video.style.height = "300px";
            video.style.maxHeight = "60vh";
            video.style.maxWidth = "60vw";
            imgTd.parentNode.replaceChild(video, imgTd);
            popup._contentNode.classList.add("media");
            video.addEventListener("loadedmetadata", function () {
              popup.update();
            });
            setTimeout(function () {
              popup.setContent(tempDiv.innerHTML);
              popup.update();
            }, 10);
          } else {
            popup._contentNode.classList.remove("media");
          }
        } else {
          popup._contentNode.classList.remove("media");
        }
      }

      // ZOOM & MEASURE CONTROL
      var zoomControl = L.control
        .zoom({
          position: "topleft",
        })
        .addTo(map);

      var measureControl = new L.Control.Measure({
        position: "topleft",
        primaryLengthUnit: "meters",
        secondaryLengthUnit: "kilometers",
        primaryAreaUnit: "sqmeters",
        secondaryAreaUnit: "hectares",
      });
      measureControl.addTo(map);
      document.getElementsByClassName("leaflet-control-measure-toggle")[0]
        .innerHTML = "";
      document.getElementsByClassName("leaflet-control-measure-toggle")[0]
        .className += " fas fa-ruler";

      var bounds_group = new L.featureGroup([]);
      function setBounds() {
        if (bounds_group.getLayers().length) {
          map.fitBounds(bounds_group.getBounds());
        }
      }

      // ========== CREATE BASEMAP LAYERS ==========
      
      // 1. OSM Standard
      map.createPane("pane_OSMStandard");
      map.getPane("pane_OSMStandard").style.zIndex = 400;
      var layer_OSMStandard = L.tileLayer(
        "http://tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          pane: "pane_OSMStandard",
          opacity: 1.0,
          attribution:
            '<a href="https://www.openstreetmap.org/copyright">© OpenStreetMap contributors, CC-BY-SA</a>',
          minZoom: 1,
          maxZoom: 28,
          minNativeZoom: 0,
          maxNativeZoom: 19,
        }
      );
      
      // 2. Google Satellite
      map.createPane("pane_GoogleSatellite");
      map.getPane("pane_GoogleSatellite").style.zIndex = 401;
      var layer_GoogleSatellite = L.tileLayer(
        "https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",
        {
          pane: "pane_GoogleSatellite",
          opacity: 1.0,
          attribution: '',
          minZoom: 1,
          maxZoom: 28,
        }
      );
      
      // 3. Google Satellite Hybrid
      map.createPane("pane_GoogleSatelliteHybrid");
      map.getPane("pane_GoogleSatelliteHybrid").style.zIndex = 402;
      var layer_GoogleSatelliteHybrid = L.tileLayer(
        "https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",
        {
          pane: "pane_GoogleSatelliteHybrid",
          opacity: 1.0,
          attribution: '',
          minZoom: 1,
          maxZoom: 28,
        }
      );
      
      // 4. Esri Imagery
      map.createPane("pane_EsriImagery");
      map.getPane("pane_EsriImagery").style.zIndex = 403;
      var layer_EsriImagery = L.tileLayer(
        "https://server.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        {
          pane: "pane_EsriImagery",
          opacity: 1.0,
          attribution: '',
          minZoom: 1,
          maxZoom: 28,
        }
      );
      
      // 5. Esri Dark Gray
      map.createPane("pane_EsriDarkGray");
      map.getPane("pane_EsriDarkGray").style.zIndex = 404;
      var layer_EsriDarkGray = L.tileLayer(
        "https://server.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",
        {
          pane: "pane_EsriDarkGray",
          opacity: 1.0,
          attribution: '',
          minZoom: 1,
          maxZoom: 28,
        }
      );
      
      // 6. Google Maps
      map.createPane("pane_GoogleMaps");
      map.getPane("pane_GoogleMaps").style.zIndex = 405;
      var layer_GoogleMaps = L.tileLayer(
        "https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",
        {
          pane: "pane_GoogleMaps",
          opacity: 1.0,
          attribution: '',
          minZoom: 1,
          maxZoom: 28,
        }
      );
      
      // Tambahkan OSM Standard sebagai basemap default
      map.addLayer(layer_OSMStandard);

      // PANEL INFORMASI
      function bukaPanel(html) {
        var panel = document.getElementById("panel-info");
        panel.style.display = "block";
        document.getElementById("isi-panel-info").innerHTML = html;
        document.body.classList.add("panel-open");
        
        // Sesuaikan posisi footer
        document.getElementById('data-source-footer').style.right = '260px';
      }

      function tutupPanel() {
        var panel = document.getElementById("panel-info");
        panel.style.display = "none";
        document.body.classList.remove("panel-open");
        
        // Kembalikan footer ke posisi semula
        document.getElementById('data-source-footer').style.right = '0';
      }

      // flag: apakah user sudah nutup instruksi pakai X
      var instruksiDitutupManual = false;

      // FUNGSI: atur instruksi di atas peta
      function updateInstruksi() {
        var box  = document.getElementById("instruksi-layer");
        var text = document.getElementById("instruksi-text");

        // cek apakah ada layer yang menampilkan info
        var cbJalan = document.getElementById("cb_jalan");
        var cbAkses = document.getElementById("cb_akses");
        var cbJumlah = document.getElementById("cb_jumlahwisata");
        
        var adaLayerInfo =
          (cbJalan && cbJalan.checked) ||
          (cbAkses && cbAkses.checked) ||
          (cbJumlah && cbJumlah.checked);

        if (!adaLayerInfo) {
          box.style.display = "none";
          return;
        }

        if (instruksiDitutupManual) return;

        box.style.display = "flex";
        text.textContent =
          "Klik wilayah kecamatan untuk melihat informasi detail.";
      }

      // tombol X di panel instruksi
      var btnInstruksiClose = document.getElementById("instruksi-close");
      btnInstruksiClose.addEventListener("click", function () {
        document.getElementById("instruksi-layer").style.display = "none";
        instruksiDitutupManual = true;
      });

      // ========== LAYER 1: Jumlah Destinasi Wisata ==========
function pop_JumlahDestinasiWisata_1(feature, layer) {
    layer.on({
        mouseout: function (e) {
            for (var i in e.target._eventParents) {
                if (typeof e.target._eventParents[i].resetStyle === "function") {
                    e.target._eventParents[i].resetStyle(e.target);
                }
            }
            if (typeof layer.closePopup == "function") {
                layer.closePopup();
            } else {
                layer.eachLayer(function (feature) {
                    feature.closePopup();
                });
            }
        },
        mouseover: highlightFeature,
    });
    
    // Klik kecamatan → buka panel info kanan
    layer.on("click", function () {
        const kecamatan = feature.properties["WADMKC"] ?? "-";
        const jumlah = feature.properties["Jml_Wis"] ?? "-";

        let html = `
            <p style="margin:0 0 6px 0;">
                <b>Kecamatan:</b> ${kecamatan}
            </p>
            <p style="margin:0 0 10px 0;">
                <b>Jumlah Destinasi Wisata:</b> ${jumlah}
            </p>
            <p style="font-size:13px; line-height:1.45; text-align:justify; text-justify:inter-word;">
                Jumlah destinasi wisata dihitung berdasarkan data sebaran destinasi wisata yang ada di Kulon Progo. 
                Data ini mencakup semua jenis wisata yang masih aktif beroperasi di wilayah tersebut.
            </p>
        `;

        bukaPanel(html);
    });
    
    var popupContent = '<table>\
            <tr>\
                <th scope="row">Kecamatan</th>\
                <td colspan="2">' + (feature.properties['WADMKC'] !== null ? autolinker.link(String(feature.properties['WADMKC']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jumlah&nbspWisata</th>\
                <td colspan="2">' + (feature.properties['Jml_Wis'] !== null ? autolinker.link(String(feature.properties['Jml_Wis']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
        </table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) {
        addClassToPopupIfMedia(content, e.popup);
    });
    layer.bindPopup(content, { maxHeight: 400 });
}

function style_JumlahDestinasiWisata_1_0(feature) {
    if (feature.properties['Jml_Wis'] >= 2.000000 && feature.properties['Jml_Wis'] <= 4.000000 ) {
        return {
            pane: 'pane_JumlahDestinasiWisata_1',
            opacity: 1,
            color: 'rgba(35,35,35,0.9)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(215,25,28,0.9)',
            interactive: true,
        }
    }
    if (feature.properties['Jml_Wis'] >= 4.000000 && feature.properties['Jml_Wis'] <= 6.000000 ) {
        return {
            pane: 'pane_JumlahDestinasiWisata_1',
            opacity: 1,
            color: 'rgba(35,35,35,0.9)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(253,174,97,0.9)',
            interactive: true,
        }
    }
    if (feature.properties['Jml_Wis'] >= 6.000000 && feature.properties['Jml_Wis'] <= 9.000000 ) {
        return {
            pane: 'pane_JumlahDestinasiWisata_1',
            opacity: 1,
            color: 'rgba(35,35,35,0.9)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(255,255,192,0.9)',
            interactive: true,
        }
    }
    if (feature.properties['Jml_Wis'] >= 9.000000 && feature.properties['Jml_Wis'] <= 16.000000 ) {
        return {
            pane: 'pane_JumlahDestinasiWisata_1',
            opacity: 1,
            color: 'rgba(35,35,35,0.9)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(166,217,106,0.9)',
            interactive: true,
        }
    }
    if (feature.properties['Jml_Wis'] >= 16.000000 && feature.properties['Jml_Wis'] <= 21.000000 ) {
        return {
            pane: 'pane_JumlahDestinasiWisata_1',
            opacity: 1,
            color: 'rgba(35,35,35,0.9)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(26,150,65,0.9)',
            interactive: true,
        }
    }
}

map.createPane('pane_JumlahDestinasiWisata_1');
map.getPane('pane_JumlahDestinasiWisata_1').style.zIndex = 410;
map.getPane('pane_JumlahDestinasiWisata_1').style['mix-blend-mode'] = 'normal';
var layer_JumlahDestinasiWisata_1 = new L.geoJson(json_JumlahDestinasiWisata_1, {
    attribution: '',
    interactive: true,
    dataVar: 'json_JumlahDestinasiWisata_1',
    layerName: 'layer_JumlahDestinasiWisata_1',
    pane: 'pane_JumlahDestinasiWisata_1',
    onEachFeature: pop_JumlahDestinasiWisata_1,
    style: style_JumlahDestinasiWisata_1_0,
});

// ========== LAYER 2: Aksesibilitas Wisata ==========
function pop_Aksesibilitas_2(feature, layer) {
    layer.on({
        mouseout: function (e) {
            for (var i in e.target._eventParents) {
                if (typeof e.target._eventParents[i].resetStyle === "function") {
                    e.target._eventParents[i].resetStyle(e.target);
                }
            }
            if (typeof layer.closePopup == "function") {
                layer.closePopup();
            } else {
                layer.eachLayer(function (feature) {
                    feature.closePopup();
                });
            }
        },
        mouseover: highlightFeature,
    });
    
    // Klik kecamatan → buka panel info kanan
    layer.on("click", function () {
        const nama = feature.properties["WADMKC"] ?? "-";
        const akses = feature.properties["akses_wisa"] ?? "-";

        let html = `
            <p style="margin:0 0 6px 0;">
                <b>Kecamatan:</b> ${nama}
            </p>
            <p style="margin:0 0 10px 0;">
                <b>Skor Aksesibilitas:</b> ${akses}
            </p>
            <p style="font-size:13px; line-height:1.45; text-align:justify; text-justify:inter-word;">
                Penilaian aksesibilitas dihitung berdasarkan jarak ke destinasi wisata terdekat 
                melalui jaringan jalan yang tersedia. Nilai yang lebih tinggi menunjukkan 
                aksesibilitas yang lebih baik, begitu pula sebaliknya.
            </p>
        `;

        bukaPanel(html);
    });
    
    var popupContent = '<table>\
            <tr>\
                <th scope="row">Kecamatan</th>\
                <td class="visible-with-data" id="WADMKC">' + (feature.properties['WADMKC'] !== null ? autolinker.link(String(feature.properties['WADMKC']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Skor&nbspAksesibilitas</th>\
                <td class="visible-with-data" id="akses_wisa">' + (feature.properties['akses_wisa'] !== null ? autolinker.link(String(feature.properties['akses_wisa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
        </table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) {
        addClassToPopupIfMedia(content, e.popup);
    });
    layer.bindPopup(content, { maxHeight: 400 });
}

function style_Aksesibilitas_2_0(feature) {
    if (feature.properties['akses_wisa'] >= 2.000000 && feature.properties['akses_wisa'] <= 3.000000 ) {
        return {
            pane: 'pane_Aksesibilitas_2',
            opacity: 1,
            color: 'rgba(35,35,35,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(247,252,245,1.0)',
            interactive: true,
        }
    }
    if (feature.properties['akses_wisa'] >= 3.000000 && feature.properties['akses_wisa'] <= 7.000000 ) {
        return {
            pane: 'pane_Aksesibilitas_2',
            opacity: 1,
            color: 'rgba(35,35,35,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(178,224,171,1.0)',
            interactive: true,
        }
    }
    if (feature.properties['akses_wisa'] >= 7.000000 && feature.properties['akses_wisa'] <= 12.500000 ) {
        return {
            pane: 'pane_Aksesibilitas_2',
            opacity: 1,
            color: 'rgba(35,35,35,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(61,167,90,1.0)',
            interactive: true,
        }
    }
    if (feature.properties['akses_wisa'] >= 12.500000 && feature.properties['akses_wisa'] <= 21.000000 ) {
        return {
            pane: 'pane_Aksesibilitas_2',
            opacity: 1,
            color: 'rgba(35,35,35,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(0,68,27,1.0)',
            interactive: true,
        }
    }
}

map.createPane('pane_Aksesibilitas_2');
map.getPane('pane_Aksesibilitas_2').style.zIndex = 411;
map.getPane('pane_Aksesibilitas_2').style['mix-blend-mode'] = 'normal';
var layer_Aksesibilitas_2 = new L.geoJson(json_Aksesibilitas_2, {
    attribution: '',
    interactive: true,
    dataVar: 'json_Aksesibilitas_2',
    layerName: 'layer_Aksesibilitas_2',
    pane: 'pane_Aksesibilitas_2',
    onEachFeature: pop_Aksesibilitas_2,
    style: style_Aksesibilitas_2_0,
});

// ========== LAYER 3: Jaringan Jalan ==========
function pop_Jalan_3(feature, layer) {
    layer.on({
        mouseout: function (e) {
            for (var i in e.target._eventParents) {
                if (typeof e.target._eventParents[i].resetStyle === "function") {
                    e.target._eventParents[i].resetStyle(e.target);
                }
            }
            if (typeof layer.closePopup == "function") {
                layer.closePopup();
            } else {
                layer.eachLayer(function (feature) {
                    feature.closePopup();
                });
            }
        },
        mouseover: highlightFeature,
    });
    
    var popupContent = '<table>\
            <tr>\
                <th scope="row">Skor&nbsp;Akses</th>\
                <td colspan="2">' + (feature.properties['skor_akses'] !== null ? autolinker.link(String(feature.properties['skor_akses']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Aksesibilitas</th>\
                <td colspan="2">' + (feature.properties['kelas_jala'] !== null ? autolinker.link(String(feature.properties['kelas_jala']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
        </table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) {
        addClassToPopupIfMedia(content, e.popup);
    });
    layer.bindPopup(content, { maxHeight: 400 });
}

function style_Jalan_3_0() {
    return {
        pane: 'pane_Jalan_3',
        opacity: 1,
        color: 'rgba(144,144,144,1.0)', // WARNA ABU-ABU
        dashArray: '',
        lineCap: 'square',
        lineJoin: 'bevel',
        weight: 1.0,
        fillOpacity: 0,
        interactive: true,
    }
}

map.createPane('pane_Jalan_3');
map.getPane('pane_Jalan_3').style.zIndex = 412;
map.getPane('pane_Jalan_3').style['mix-blend-mode'] = 'normal';
var layer_Jalan_3 = new L.geoJson(json_Jalan_3, {
    attribution: '',
    interactive: true,
    dataVar: 'json_Jalan_3',
    layerName: 'layer_Jalan_3',
    pane: 'pane_Jalan_3',
    onEachFeature: pop_Jalan_3,
    style: style_Jalan_3_0,
});

// ========== LAYER 4: Wisata Minat Khusus ==========
function pop_WisataMinat_4(feature, layer) {
    layer.on({
        mouseout: function (e) {
            if (typeof layer.closePopup == "function") {
                layer.closePopup();
            } else {
                layer.eachLayer(function (feature) {
                    feature.closePopup();
                });
            }
        },
        mouseover: highlightFeature,
    });
    
    var popupContent = '<table>\
            <tr>\
                <th scope="row">Nama&nbsp;Tempat</th>\
                <td class="visible-with-data" id="Nama_Tempa">' + (feature.properties['Nama_Tempa'] !== null ? autolinker.link(String(feature.properties['Nama_Tempa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Alamat</th>\
                <td class="visible-with-data" id="Alamat">' + (feature.properties['Alamat'] !== null ? autolinker.link(String(feature.properties['Alamat']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jenis&nbsp;Wisata</th>\
                <td class="visible-with-data" id="Jenis Wisata">' + (feature.properties['Jenis_Wisa'] !== null ? autolinker.link(String(feature.properties['Jenis_Wisa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Nilai</th>\
                <td class="visible-with-data" id="Nilai">' + (feature.properties['Nilai'] !== null ? autolinker.link(String(feature.properties['Nilai']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jumlah&nbsp;Penilai</th>\
                <td class="visible-with-data" id="Jumlah_Pen">' + (feature.properties['Jumlah_Pen'] !== null ? autolinker.link(String(feature.properties['Jumlah_Pen']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
        </table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) {
        addClassToPopupIfMedia(content, e.popup);
    });
    layer.bindPopup(content, { maxHeight: 400 });
}

function style_WisataMinat_4_0(feature) {
    if (feature.properties['Skor'] >= 0.000000 && feature.properties['Skor'] <= 158.400000 ) {
        return {
            pane: 'pane_WisataMinat_4',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataMinat_4.svg',
                iconSize: [11.399999999999999, 11.399999999999999]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 158.400000 && feature.properties['Skor'] <= 441.600000 ) {
        return {
            pane: 'pane_WisataMinat_4',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataMinat_4.svg',
                iconSize: [15.2, 15.2]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 441.600000 && feature.properties['Skor'] <= 1393.200000 ) {
        return {
            pane: 'pane_WisataMinat_4',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataMinat_4.svg',
                iconSize: [19.0, 19.0]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 1393.200000 && feature.properties['Skor'] <= 5662.100000 ) {
        return {
            pane: 'pane_WisataMinat_4',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataMinat_4.svg',
                iconSize: [22.799999999999997, 22.799999999999997]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 5662.100000 && feature.properties['Skor'] <= 44617.100000 ) {
        return {
            pane: 'pane_WisataMinat_4',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataMinat_4.svg',
                iconSize: [26.599999999999998, 26.599999999999998]
            }),
            interactive: true,
        }
    }
}

map.createPane('pane_WisataMinat_4');
map.getPane('pane_WisataMinat_4').style.zIndex = 413;
map.getPane('pane_WisataMinat_4').style['mix-blend-mode'] = 'normal';
var layer_WisataMinat_4 = new L.geoJson(json_WisataMinat_4, {
    attribution: '',
    interactive: true,
    dataVar: 'json_WisataMinat_4',
    layerName: 'layer_WisataMinat_4',
    pane: 'pane_WisataMinat_4',
    onEachFeature: pop_WisataMinat_4,
    pointToLayer: function (feature, latlng) {
        return L.marker(latlng, style_WisataMinat_4_0(feature));
    },
});

// ========== LAYER 5: Wisata Budaya ==========
function pop_WisataBudaya_5(feature, layer) {
    layer.on({
        mouseout: function (e) {
            if (typeof layer.closePopup == "function") {
                layer.closePopup();
            } else {
                layer.eachLayer(function (feature) {
                    feature.closePopup();
                });
            }
        },
        mouseover: highlightFeature,
    });
    
    var popupContent = '<table>\
            <tr>\
                <th scope="row">Nama&nbsp;Tempat</th>\
                <td class="visible-with-data" id="Nama_Tempa">' + (feature.properties['Nama_Tempa'] !== null ? autolinker.link(String(feature.properties['Nama_Tempa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Alamat</th>\
                <td class="visible-with-data" id="Alamat">' + (feature.properties['Alamat'] !== null ? autolinker.link(String(feature.properties['Alamat']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jenis&nbsp;Wisata</th>\
                <td class="visible-with-data" id="Jenis_Wisa">' + (feature.properties['Jenis_Wisa'] !== null ? autolinker.link(String(feature.properties['Jenis_Wisa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Nilai</th>\
                <td class="visible-with-data" id="Nilai">' + (feature.properties['Nilai'] !== null ? autolinker.link(String(feature.properties['Nilai']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jumlah&nbsp;Penilai</th>\
                <td class="visible-with-data" id="Jumlah_Pen">' + (feature.properties['Jumlah_Pen'] !== null ? autolinker.link(String(feature.properties['Jumlah_Pen']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
        </table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) {
        addClassToPopupIfMedia(content, e.popup);
    });
    layer.bindPopup(content, { maxHeight: 400 });
}

function style_WisataBudaya_5_0(feature) {
    if (feature.properties['Skor'] >= 0.000000 && feature.properties['Skor'] <= 158.400000 ) {
        return {
            pane: 'pane_WisataBudaya_5',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBudaya_5.svg',
                iconSize: [13.299999999999999, 13.299999999999999]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 158.400000 && feature.properties['Skor'] <= 441.600000 ) {
        return {
            pane: 'pane_WisataBudaya_5',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBudaya_5.svg',
                iconSize: [17.099999999999998, 17.099999999999998]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 441.600000 && feature.properties['Skor'] <= 1393.200000 ) {
        return {
            pane: 'pane_WisataBudaya_5',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBudaya_5.svg',
                iconSize: [20.9, 20.9]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 1393.200000 && feature.properties['Skor'] <= 5662.100000 ) {
        return {
            pane: 'pane_WisataBudaya_5',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBudaya_5.svg',
                iconSize: [24.7, 24.7]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 5662.100000 && feature.properties['Skor'] <= 44617.100000 ) {
        return {
            pane: 'pane_WisataBudaya_5',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBudaya_5.svg',
                iconSize: [28.5, 28.5]
            }),
            interactive: true,
        }
    }
}

map.createPane('pane_WisataBudaya_5');
map.getPane('pane_WisataBudaya_5').style.zIndex = 414;
map.getPane('pane_WisataBudaya_5').style['mix-blend-mode'] = 'normal';
var layer_WisataBudaya_5 = new L.geoJson(json_WisataBudaya_5, {
    attribution: '',
    interactive: true,
    dataVar: 'json_WisataBudaya_5',
    layerName: 'layer_WisataBudaya_5',
    pane: 'pane_WisataBudaya_5',
    onEachFeature: pop_WisataBudaya_5,
    pointToLayer: function (feature, latlng) {
        return L.marker(latlng, style_WisataBudaya_5_0(feature));
    },
});

// ========== LAYER 6: Wisata Buatan ==========
function pop_WisataBuatan_6(feature, layer) {
    layer.on({
        mouseout: function (e) {
            if (typeof layer.closePopup == "function") {
                layer.closePopup();
            } else {
                layer.eachLayer(function (feature) {
                    feature.closePopup();
                });
            }
        },
        mouseover: highlightFeature,
    });
    
    var popupContent = '<table>\
            <tr>\
                <th scope="row">Nama&nbsp;Tempat</th>\
                <td class="visible-with-data" id="Nama_Tempa">' + (feature.properties['Nama_Tempa'] !== null ? autolinker.link(String(feature.properties['Nama_Tempa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Alamat</th>\
                <td class="visible-with-data" id="Alamat">' + (feature.properties['Alamat'] !== null ? autolinker.link(String(feature.properties['Alamat']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jenis&nbsp;Wisata</th>\
                <td class="visible-with-data" id="Jenis_Wisa">' + (feature.properties['Jenis_Wisa'] !== null ? autolinker.link(String(feature.properties['Jenis_Wisa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Nilai</th>\
                <td class="visible-with-data" id="Nilai">' + (feature.properties['Nilai'] !== null ? autolinker.link(String(feature.properties['Nilai']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jumlah&nbsp;Penilai</th>\
                <td class="visible-with-data" id="Jumlah_Pen">' + (feature.properties['Jumlah_Pen'] !== null ? autolinker.link(String(feature.properties['Jumlah_Pen']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
        </table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) {
        addClassToPopupIfMedia(content, e.popup);
    });
    layer.bindPopup(content, { maxHeight: 400 });
}

function style_WisataBuatan_6_0(feature) {
    if (feature.properties['Skor'] >= 0.000000 && feature.properties['Skor'] <= 158.400000 ) {
        return {
            pane: 'pane_WisataBuatan_6',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBuatan_6.svg',
                iconSize: [11.399999999999999, 11.399999999999999]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 158.400000 && feature.properties['Skor'] <= 441.600000 ) {
        return {
            pane: 'pane_WisataBuatan_6',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBuatan_6.svg',
                iconSize: [15.2, 15.2]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 441.600000 && feature.properties['Skor'] <= 1393.200000 ) {
        return {
            pane: 'pane_WisataBuatan_6',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBuatan_6.svg',
                iconSize: [19.0, 19.0]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 1393.200000 && feature.properties['Skor'] <= 5662.100000 ) {
        return {
            pane: 'pane_WisataBuatan_6',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBuatan_6.svg',
                iconSize: [22.799999999999997, 22.799999999999997]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 5662.100000 && feature.properties['Skor'] <= 44617.100000 ) {
        return {
            pane: 'pane_WisataBuatan_6',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBuatan_6.svg',
                iconSize: [26.599999999999998, 26.599999999999998]
            }),
            interactive: true,
        }
    }
}

map.createPane('pane_WisataBuatan_6');
map.getPane('pane_WisataBuatan_6').style.zIndex = 415;
map.getPane('pane_WisataBuatan_6').style['mix-blend-mode'] = 'normal';
var layer_WisataBuatan_6 = new L.geoJson(json_WisataBuatan_6, {
    attribution: '',
    interactive: true,
    dataVar: 'json_WisataBuatan_6',
    layerName: 'layer_WisataBuatan_6',
    pane: 'pane_WisataBuatan_6',
    onEachFeature: pop_WisataBuatan_6,
    pointToLayer: function (feature, latlng) {
        return L.marker(latlng, style_WisataBuatan_6_0(feature));
    },
});

// ========== LAYER 7: Wisata Bahari ==========
function pop_WisataBahari_7(feature, layer) {
    layer.on({
        mouseout: function (e) {
            if (typeof layer.closePopup == "function") {
                layer.closePopup();
            } else {
                layer.eachLayer(function (feature) {
                    feature.closePopup();
                });
            }
        },
        mouseover: highlightFeature,
    });
    
    var popupContent = '<table>\
            <tr>\
                <th scope="row">Nama&nbsp;Tempat</th>\
                <td class="visible-with-data" id="Nama_Tempa">' + (feature.properties['Nama_Tempa'] !== null ? autolinker.link(String(feature.properties['Nama_Tempa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Alamat</th>\
                <td class="visible-with-data" id="Alamat">' + (feature.properties['Alamat'] !== null ? autolinker.link(String(feature.properties['Alamat']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jenis&nbsp;Wisata</th>\
                <td class="visible-with-data" id="Jenis_Wisa">' + (feature.properties['Jenis_Wisa'] !== null ? autolinker.link(String(feature.properties['Jenis_Wisa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Nilai</th>\
                <td class="visible-with-data" id="Nilai">' + (feature.properties['Nilai'] !== null ? autolinker.link(String(feature.properties['Nilai']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jumlah&nbsp;Penilai</th>\
                <td class="visible-with-data" id="Jumlah_Pen">' + (feature.properties['Jumlah_Pen'] !== null ? autolinker.link(String(feature.properties['Jumlah_Pen']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
        </table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) {
        addClassToPopupIfMedia(content, e.popup);
    });
    layer.bindPopup(content, { maxHeight: 400 });
}

function style_WisataBahari_7_0(feature) {
    if (feature.properties['Skor'] >= 0.000000 && feature.properties['Skor'] <= 158.400000 ) {
        return {
            pane: 'pane_WisataBahari_7',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBahari_7.svg',
                iconSize: [11.399999999999999, 11.399999999999999]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 158.400000 && feature.properties['Skor'] <= 441.600000 ) {
        return {
            pane: 'pane_WisataBahari_7',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBahari_7.svg',
                iconSize: [15.2, 15.2]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 441.600000 && feature.properties['Skor'] <= 1393.200000 ) {
        return {
            pane: 'pane_WisataBahari_7',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBahari_7.svg',
                iconSize: [19.0, 19.0]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 1393.200000 && feature.properties['Skor'] <= 5662.100000 ) {
        return {
            pane: 'pane_WisataBahari_7',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBahari_7.svg',
                iconSize: [22.799999999999997, 22.799999999999997]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 5662.100000 && feature.properties['Skor'] <= 44617.100000 ) {
        return {
            pane: 'pane_WisataBahari_7',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataBahari_7.svg',
                iconSize: [26.599999999999998, 26.599999999999998]
            }),
            interactive: true,
        }
    }
}

map.createPane('pane_WisataBahari_7');
map.getPane('pane_WisataBahari_7').style.zIndex = 416;
map.getPane('pane_WisataBahari_7').style['mix-blend-mode'] = 'normal';
var layer_WisataBahari_7 = new L.geoJson(json_WisataBahari_7, {
    attribution: '',
    interactive: true,
    dataVar: 'json_WisataBahari_7',
    layerName: 'layer_WisataBahari_7',
    pane: 'pane_WisataBahari_7',
    onEachFeature: pop_WisataBahari_7,
    pointToLayer: function (feature, latlng) {
        return L.marker(latlng, style_WisataBahari_7_0(feature));
    },
});

// ========== LAYER 8: Wisata Alam ==========
function pop_WisataAlam_8(feature, layer) {
    layer.on({
        mouseout: function (e) {
            if (typeof layer.closePopup == "function") {
                layer.closePopup();
            } else {
                layer.eachLayer(function (feature) {
                    feature.closePopup();
                });
            }
        },
        mouseover: highlightFeature,
    });
    
    var popupContent = '<table>\
            <tr>\
                <th scope="row">Nama&nbsp;Tempat</th>\
                <td class="visible-with-data" id="Nama_Tempa">' + (feature.properties['Nama_Tempa'] !== null ? autolinker.link(String(feature.properties['Nama_Tempa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Alamat</th>\
                <td class="visible-with-data" id="Alamat">' + (feature.properties['Alamat'] !== null ? autolinker.link(String(feature.properties['Alamat']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jenis&nbsp;Wisata</th>\
                <td class="visible-with-data" id="Jenis_Wisa">' + (feature.properties['Jenis_Wisa'] !== null ? autolinker.link(String(feature.properties['Jenis_Wisa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Nilai</th>\
                <td class="visible-with-data" id="Nilai">' + (feature.properties['Nilai'] !== null ? autolinker.link(String(feature.properties['Nilai']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jumlah&nbsp;Penilai</th>\
                <td class="visible-with-data" id="Jumlah_Pen">' + (feature.properties['Jumlah_Pen'] !== null ? autolinker.link(String(feature.properties['Jumlah_Pen']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
        </table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) {
        addClassToPopupIfMedia(content, e.popup);
    });
    layer.bindPopup(content, { maxHeight: 400 });
}

function style_WisataAlam_8_0(feature) {
    if (feature.properties['Skor'] >= 0.000000 && feature.properties['Skor'] <= 158.400000 ) {
        return {
            pane: 'pane_WisataAlam_8',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataAlam_8.svg',
                iconSize: [15.2, 15.2]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 158.400000 && feature.properties['Skor'] <= 441.600000 ) {
        return {
            pane: 'pane_WisataAlam_8',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataAlam_8.svg',
                iconSize: [19.0, 19.0]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 441.600000 && feature.properties['Skor'] <= 1393.200000 ) {
        return {
            pane: 'pane_WisataAlam_8',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataAlam_8.svg',
                iconSize: [22.799999999999997, 22.799999999999997]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 1393.200000 && feature.properties['Skor'] <= 5662.100000 ) {
        return {
            pane: 'pane_WisataAlam_8',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataAlam_8.svg',
                iconSize: [26.599999999999998, 26.599999999999998]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 5662.100000 && feature.properties['Skor'] <= 44617.100000 ) {
        return {
            pane: 'pane_WisataAlam_8',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/WisataAlam_8.svg',
                iconSize: [30.4, 30.4]
            }),
            interactive: true,
        }
    }
}

map.createPane('pane_WisataAlam_8');
map.getPane('pane_WisataAlam_8').style.zIndex = 417;
map.getPane('pane_WisataAlam_8').style['mix-blend-mode'] = 'normal';
var layer_WisataAlam_8 = new L.geoJson(json_WisataAlam_8, {
    attribution: '',
    interactive: true,
    dataVar: 'json_WisataAlam_8',
    layerName: 'layer_WisataAlam_8',
    pane: 'pane_WisataAlam_8',
    onEachFeature: pop_WisataAlam_8,
    pointToLayer: function (feature, latlng) {
        return L.marker(latlng, style_WisataAlam_8_0(feature));
    },
});

// ========== LAYER 9: Desa Wisata ==========
function pop_DesaWisata_9(feature, layer) {
    layer.on({
        mouseout: function (e) {
            if (typeof layer.closePopup == "function") {
                layer.closePopup();
            } else {
                layer.eachLayer(function (feature) {
                    feature.closePopup();
                });
            }
        },
        mouseover: highlightFeature,
    });
    
    var popupContent = '<table>\
            <tr>\
                <th scope="row">Nama&nbsp;Tempat</th>\
                <td class="visible-with-data" id="Nama_Tempa">' + (feature.properties['Nama_Tempa'] !== null ? autolinker.link(String(feature.properties['Nama_Tempa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Alamat</th>\
                <td class="visible-with-data" id="Alamat">' + (feature.properties['Alamat'] !== null ? autolinker.link(String(feature.properties['Alamat']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jenis&nbsp;Wisata</th>\
                <td class="visible-with-data" id="Jenis_Wisa">' + (feature.properties['Jenis_Wisa'] !== null ? autolinker.link(String(feature.properties['Jenis_Wisa']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Nilai</th>\
                <td class="visible-with-data" id="Nilai">' + (feature.properties['Nilai'] !== null ? autolinker.link(String(feature.properties['Nilai']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Jumlah&nbsp;Penilai</th>\
                <td class="visible-with-data" id="Jumlah_Pen">' + (feature.properties['Jumlah_Pen'] !== null ? autolinker.link(String(feature.properties['Jumlah_Pen']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
            </tr>\
        </table>';
    var content = removeEmptyRowsFromPopupContent(popupContent, feature);
    layer.on('popupopen', function(e) {
        addClassToPopupIfMedia(content, e.popup);
    });
    layer.bindPopup(content, { maxHeight: 400 });
}

function style_DesaWisata_9_0(feature) {
    if (feature.properties['Skor'] >= 0.000000 && feature.properties['Skor'] <= 158.400000 ) {
        return {
            pane: 'pane_DesaWisata_9',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/DesaWisata_9.svg',
                iconSize: [11.399999999999999, 11.399999999999999]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 158.400000 && feature.properties['Skor'] <= 441.600000 ) {
        return {
            pane: 'pane_DesaWisata_9',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/DesaWisata_9.svg',
                iconSize: [14.25, 14.25]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 441.600000 && feature.properties['Skor'] <= 1393.200000 ) {
        return {
            pane: 'pane_DesaWisata_9',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/DesaWisata_9.svg',
                iconSize: [17.099999999999998, 17.099999999999998]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 1393.200000 && feature.properties['Skor'] <= 5662.100000 ) {
        return {
            pane: 'pane_DesaWisata_9',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/DesaWisata_9.svg',
                iconSize: [19.95, 19.95]
            }),
            interactive: true,
        }
    }
    if (feature.properties['Skor'] >= 5662.100000 && feature.properties['Skor'] <= 44617.100000 ) {
        return {
            pane: 'pane_DesaWisata_9',
            rotationAngle: 0.0,
            rotationOrigin: 'center center',
            icon: L.icon({
                iconUrl: 'markers/DesaWisata_9.svg',
                iconSize: [22.799999999999997, 22.799999999999997]
            }),
            interactive: true,
        }
    }
}

map.createPane('pane_DesaWisata_9');
map.getPane('pane_DesaWisata_9').style.zIndex = 418;
map.getPane('pane_DesaWisata_9').style['mix-blend-mode'] = 'normal';
var layer_DesaWisata_9 = new L.geoJson(json_DesaWisata_9, {
    attribution: '',
    interactive: true,
    dataVar: 'json_DesaWisata_9',
    layerName: 'layer_DesaWisata_9',
    pane: 'pane_DesaWisata_9',
    onEachFeature: pop_DesaWisata_9,
    pointToLayer: function (feature, latlng) {
        return L.marker(latlng, style_DesaWisata_9_0(feature));
    },
});

      // Hapus layer tree control bawaan qgis2web
      // var lay = L.control.layers.tree(null, overlaysTree, {
      //   collapsed: true,
      // });
      // lay.addTo(map);

      // Semua overlay dimatikan dulu
      map.removeLayer(layer_JumlahDestinasiWisata_1);
      map.removeLayer(layer_Aksesibilitas_2);
      map.removeLayer(layer_Jalan_3);
      map.removeLayer(layer_WisataMinat_4);
      map.removeLayer(layer_WisataBudaya_5);
      map.removeLayer(layer_WisataBuatan_6);
      map.removeLayer(layer_WisataBahari_7);
      map.removeLayer(layer_WisataAlam_8);
      map.removeLayer(layer_DesaWisata_9);

      setBounds();
      
      // ====== CREATE LAYER CONTROL FOR BASEMAPS ======
      // Buat layer control untuk pergantian basemap di pojok kanan bawah
      var baseMaps = {
        "OSM Standard": layer_OSMStandard,
        "Google Satellite": layer_GoogleSatellite,
        "Google Satellite Hybrid": layer_GoogleSatelliteHybrid,
        "Esri Imagery": layer_EsriImagery,
        "Esri Dark Gray": layer_EsriDarkGray,
        "Google Maps": layer_GoogleMaps
      };
      
      // Tambahkan layer control di pojok kanan bawah
      var layerControl = L.control.layers(baseMaps, null, {
        position: 'bottomright',
        collapsed: true // Bisa dibuka/tutup
      }).addTo(map);
      
      // ====== FUNGSI PENCARIAN ======
      
      // Kumpulkan semua layer wisata ke dalam array
      allWisataLayers = [
        { layer: layer_DesaWisata_9, type: "Desa Wisata", id: "desawisata" },
        { layer: layer_WisataAlam_8, type: "Wisata Alam", id: "wisataalam" },
        { layer: layer_WisataBahari_7, type: "Wisata Bahari", id: "wisatabahari" },
        { layer: layer_WisataBuatan_6, type: "Wisata Buatan", id: "wisatabuatan" },
        { layer: layer_WisataMinat_4, type: "Wisata Minat Khusus", id: "wisataminat" },
        { layer: layer_WisataBudaya_5, type: "Wisata Budaya", id: "wisatabudaya" }
      ];
      
      // Bangun indeks pencarian dari semua feature
      function buildSearchIndex() {
        searchIndex = [];
        
        allWisataLayers.forEach(function(layerInfo) {
          layerInfo.layer.eachLayer(function(marker) {
            var feature = marker.feature;
            if (feature && feature.properties && feature.properties.Nama_Tempa) {
              var latlng = marker.getLatLng();
              searchIndex.push({
                id: searchIndex.length,
                name: feature.properties.Nama_Tempa,
                layerType: layerInfo.type,
                layerId: layerInfo.id,
                latlng: latlng,
                feature: feature,
                marker: marker
              });
            }
          });
        });
        
        console.log("Indeks pencarian dibangun: " + searchIndex.length + " destinasi wisata ditemukan.");
      }
      
      // Pencarian destinasi wisata
      function searchDestinasi(query) {
        if (!query || query.trim() === '') {
          return [];
        }
        
        var searchTerm = query.toLowerCase().trim();
        var results = [];
        
        // Cari yang cocok (case insensitive)
        searchIndex.forEach(function(item) {
          if (item.name.toLowerCase().includes(searchTerm)) {
            results.push(item);
          }
        });
        
        // Urutkan berdasarkan kemiripan
        results.sort(function(a, b) {
          var aIndex = a.name.toLowerCase().indexOf(searchTerm);
          var bIndex = b.name.toLowerCase().indexOf(searchTerm);
          
          // Yang diawali dengan query diutamakan
          if (aIndex === 0 && bIndex !== 0) return -1;
          if (aIndex !== 0 && bIndex === 0) return 1;
          
          // Kemudian urutkan berdasarkan panjang nama
          return a.name.length - b.name.length;
        });
        
        return results;
      }
      
      // Tampilkan hasil pencarian
      function displaySearchResults(results) {
        var resultsContainer = document.getElementById('searchResults');
        
        if (results.length === 0) {
          resultsContainer.innerHTML = '<div class="no-results">Tidak ada destinasi wisata yang ditemukan</div>';
          return;
        }
        
        var html = '';
        results.forEach(function(item, index) {
          html += '<div class="search-result-item" data-id="' + item.id + '">';
          html += '<div class="result-name">' + item.name + '</div>';
          html += '<div class="result-details">';
          html += '<span class="result-type">' + item.layerType + '</span>';
          html += '</div>';
          html += '</div>';
        });
        
        resultsContainer.innerHTML = html;
        
        // Tambahkan event listener untuk setiap hasil
        var resultItems = resultsContainer.getElementsByClassName('search-result-item');
        for (var i = 0; i < resultItems.length; i++) {
          resultItems[i].addEventListener('click', function() {
            var id = parseInt(this.getAttribute('data-id'));
            var item = searchIndex.find(function(el) { return el.id === id; });
            if (item) {
              navigateToDestinasi(item);
            }
          });
          
          // Efek hover
          resultItems[i].addEventListener('mouseenter', function() {
            this.classList.add('active');
          });
          
          resultItems[i].addEventListener('mouseleave', function() {
            this.classList.remove('active');
          });
        }
      }
      
      // Navigasi ke destinasi yang dipilih
      function navigateToDestinasi(item) {
        // Zoom dan pan ke lokasi
        map.setView(item.latlng, 15);
        
        // Pastikan layer yang sesuai aktif
        activateWisataLayer(item.layerId);
        
        // Buka popup marker asli
        if (item.marker && typeof item.marker.openPopup === 'function') {
          // Tunggu sebentar agar map selesai berpindah
          setTimeout(function() {
            item.marker.openPopup();
          }, 500);
        }
        
        // Sembunyikan panel pencarian
        toggleSearchPanel();
      }
      
      // Aktifkan layer wisata yang sesuai
      function activateWisataLayer(layerId) {
        // Aktifkan checkbox jenis wisata
        document.getElementById('cb_jeniswisata').checked = true;
        document.getElementById('sub-jeniswisata').style.display = 'block';
        
        // Aktifkan sub-checkbox yang sesuai
        var checkbox = document.getElementById('cb_' + layerId);
        if (checkbox) {
          checkbox.checked = true;
          
          // Tambahkan layer jika belum ditambahkan
          var layerMap = {
            'desawisata': layer_DesaWisata_9,
            'wisataalam': layer_WisataAlam_8,
            'wisatabahari': layer_WisataBahari_7,
            'wisatabuatan': layer_WisataBuatan_6,
            'wisataminat': layer_WisataMinat_4,
            'wisatabudaya': layer_WisataBudaya_5
          };
          
          if (layerMap[layerId] && !map.hasLayer(layerMap[layerId])) {
            map.addLayer(layerMap[layerId]);
          }
          
          // Tampilkan legenda
          var legend = document.getElementById('leg_' + layerId);
          if (legend) {
            legend.style.display = 'block';
          }
        }
      }
      
      // Toggle panel pencarian
      function toggleSearchPanel() {
        var searchContainer = document.getElementById('searchContainer');
        var searchToggle = document.getElementById('searchToggle');
        
        if (searchVisible) {
          searchContainer.style.display = 'none';
          searchToggle.innerHTML = '<i class="fas fa-search"></i>';
        } else {
          searchContainer.style.display = 'block';
          searchToggle.innerHTML = '<i class="fas fa-times"></i>';
          // Fokus ke input pencarian
          document.getElementById('searchInput').focus();
        }
        
        searchVisible = !searchVisible;
      }
      
      // ====== INITIALIZE SEARCH ======
      
      // Bangun indeks pencarian setelah semua layer dimuat
      setTimeout(function() {
        buildSearchIndex();
      }, 1000);
      
      // Event listener untuk input pencarian
      document.getElementById('searchInput').addEventListener('input', function() {
        var query = this.value;
        var results = searchDestinasi(query);
        displaySearchResults(results);
      });
      
      // Event listener untuk tombol toggle pencarian
      document.getElementById('searchToggle').addEventListener('click', toggleSearchPanel);
      
      // Event listener untuk tombol close di panel pencarian
      document.getElementById('closeSearch').addEventListener('click', toggleSearchPanel);
      
      // Event listener untuk Enter pada input pencarian
      document.getElementById('searchInput').addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
          var results = searchDestinasi(this.value);
          if (results.length > 0) {
            navigateToDestinasi(results[0]);
          }
        }
      });
      
      // ====== CONTROL SIDEBAR LAYER ======
      // Checkbox
      var cbJalan = document.getElementById("cb_jalan");
      var cbJenisWisata = document.getElementById("cb_jeniswisata");
      var cbAkses = document.getElementById("cb_akses");
      var cbJumlah = document.getElementById("cb_jumlahwisata");
      
      // Sub-checkbox
      var cbDesaWisata = document.getElementById("cb_desawisata");
      var cbWisataAlam = document.getElementById("cb_wisataalam");
      var cbWisataBahari = document.getElementById("cb_wisatabahari");
      var cbWisataBuatan = document.getElementById("cb_wisatabuatan");
      var cbWisataMinat = document.getElementById("cb_wisataminat");
      var cbWisataBudaya = document.getElementById("cb_wisatabudaya");
      
      // Sub-container
      var subJenisWisata = document.getElementById("sub-jeniswisata");

      // Legenda
      var legJalan = document.getElementById("leg_jalan");
      var legDesaWisata = document.getElementById("leg_desawisata");
      var legWisataAlam = document.getElementById("leg_wisataalam");
      var legWisataBahari = document.getElementById("leg_wisatabahari");
      var legWisataBuatan = document.getElementById("leg_wisatabuatan");
      var legWisataMinat = document.getElementById("leg_wisataminat");
      var legWisataBudaya = document.getElementById("leg_wisatabudaya");
      var legAkses = document.getElementById("leg_akses");
      var legJumlah = document.getElementById("leg_jumlahwisata");

      // Instruksi
      var instruksiBox = document.getElementById("instruksi-layer");

      // --- Kondisi awal: SEMUA overlay & legenda mati, instruksi mati ---
      cbJalan.checked = false;
      cbJenisWisata.checked = false;
      cbAkses.checked = false;
      cbJumlah.checked = false;
      cbDesaWisata.checked = false;
      cbWisataAlam.checked = false;
      cbWisataBahari.checked = false;
      cbWisataBuatan.checked = false;
      cbWisataMinat.checked = false;
      cbWisataBudaya.checked = false;

      subJenisWisata.style.display = "none";

      // ====== FUNGSI BANTU ======
      function updateInstruksi() {
        if (!instruksiBox) return;

        var adaLayerInfo =
          cbJalan.checked ||
          cbAkses.checked ||
          cbJumlah.checked;

        if (!adaLayerInfo) {
          instruksiBox.style.display = "none";
          return;
        }

        if (instruksiDitutupManual) return;
        instruksiBox.style.display = "flex";
      }

      // Fungsi: toggle exclusive antara akses dan jumlah
      function toggleExclusive(clickedId) {
        if (clickedId === "cb_akses" && cbAkses.checked) {
          cbJumlah.checked = false;
          map.removeLayer(layer_JumlahDestinasiWisata_1);
          if (legJumlah) legJumlah.style.display = "none";
        } else if (clickedId === "cb_jumlahwisata" && cbJumlah.checked) {
          cbAkses.checked = false;
          map.removeLayer(layer_Aksesibilitas_2);
          if (legAkses) legAkses.style.display = "none";
        }
        updateInstruksi();
      }

      // ====== HANDLER CHECKBOX ======
      // Jaringan Jalan
      cbJalan.addEventListener("change", function () {
        if (this.checked) {
          map.addLayer(layer_Jalan_3);
          if (legJalan) legJalan.style.display = "block";
        } else {
          map.removeLayer(layer_Jalan_3);
          if (legJalan) legJalan.style.display = "none";
        }
        updateInstruksi();
      });

      // Jenis Wisata (Group)
      cbJenisWisata.addEventListener("change", function () {
        if (this.checked) {
          subJenisWisata.style.display = "block";
        } else {
          subJenisWisata.style.display = "none";
          // Matikan semua sub-checkbox
          cbDesaWisata.checked = false;
          cbWisataAlam.checked = false;
          cbWisataBahari.checked = false;
          cbWisataBuatan.checked = false;
          cbWisataMinat.checked = false;
          cbWisataBudaya.checked = false;
          
          // Hapus semua layer
          map.removeLayer(layer_DesaWisata_9);
          map.removeLayer(layer_WisataAlam_8);
          map.removeLayer(layer_WisataBahari_7);
          map.removeLayer(layer_WisataBuatan_6);
          map.removeLayer(layer_WisataMinat_4);
          map.removeLayer(layer_WisataBudaya_5);
          
          // Sembunyikan semua legenda
          if (legDesaWisata) legDesaWisata.style.display = "none";
          if (legWisataAlam) legWisataAlam.style.display = "none";
          if (legWisataBahari) legWisataBahari.style.display = "none";
          if (legWisataBuatan) legWisataBuatan.style.display = "none";
          if (legWisataMinat) legWisataMinat.style.display = "none";
          if (legWisataBudaya) legWisataBudaya.style.display = "none";
        }
      });

      // Sub-checkbox: Desa Wisata
      cbDesaWisata.addEventListener("change", function () {
        if (this.checked) {
          map.addLayer(layer_DesaWisata_9);
          if (legDesaWisata) legDesaWisata.style.display = "block";
        } else {
          map.removeLayer(layer_DesaWisata_9);
          if (legDesaWisata) legDesaWisata.style.display = "none";
        }
      });

      // Sub-checkbox: Wisata Alam
      cbWisataAlam.addEventListener("change", function () {
        if (this.checked) {
          map.addLayer(layer_WisataAlam_8);
          if (legWisataAlam) legWisataAlam.style.display = "block";
        } else {
          map.removeLayer(layer_WisataAlam_8);
          if (legWisataAlam) legWisataAlam.style.display = "none";
        }
      });

      // Sub-checkbox: Wisata Bahari
      cbWisataBahari.addEventListener("change", function () {
        if (this.checked) {
          map.addLayer(layer_WisataBahari_7);
          if (legWisataBahari) legWisataBahari.style.display = "block";
        } else {
          map.removeLayer(layer_WisataBahari_7);
          if (legWisataBahari) legWisataBahari.style.display = "none";
        }
      });

      // Sub-checkbox: Wisata Buatan
      cbWisataBuatan.addEventListener("change", function () {
        if (this.checked) {
          map.addLayer(layer_WisataBuatan_6);
          if (legWisataBuatan) legWisataBuatan.style.display = "block";
        } else {
          map.removeLayer(layer_WisataBuatan_6);
          if (legWisataBuatan) legWisataBuatan.style.display = "none";
        }
      });

      // Sub-checkbox: Wisata Minat
      cbWisataMinat.addEventListener("change", function () {
        if (this.checked) {
          map.addLayer(layer_WisataMinat_4);
          if (legWisataMinat) legWisataMinat.style.display = "block";
        } else {
          map.removeLayer(layer_WisataMinat_4);
          if (legWisataMinat) legWisataMinat.style.display = "none";
        }
      });

      // Sub-checkbox: Wisata Budaya
      cbWisataBudaya.addEventListener("change", function () {
        if (this.checked) {
          map.addLayer(layer_WisataBudaya_5);
          if (legWisataBudaya) legWisataBudaya.style.display = "block";
        } else {
          map.removeLayer(layer_WisataBudaya_5);
          if (legWisataBudaya) legWisataBudaya.style.display = "none";
        }
      });

      // Aksesibilitas Wisata
      cbAkses.addEventListener("change", function () {
        toggleExclusive("cb_akses");
        if (this.checked) {
          map.addLayer(layer_Aksesibilitas_2);
          if (legAkses) legAkses.style.display = "block";
        } else {
          map.removeLayer(layer_Aksesibilitas_2);
          if (legAkses) legAkses.style.display = "none";
        }
        updateInstruksi();
      });

      // Jumlah Destinasi Wisata
      cbJumlah.addEventListener("change", function () {
        toggleExclusive("cb_jumlahwisata");
        if (this.checked) {
          map.addLayer(layer_JumlahDestinasiWisata_1);
          if (legJumlah) legJumlah.style.display = "block";
        } else {
          map.removeLayer(layer_JumlahDestinasiWisata_1);
          if (legJumlah) legJumlah.style.display = "none";
        }
        updateInstruksi();
      });

      // Tombol X di panel instruksi
      btnInstruksiClose.addEventListener("click", function () {
        document.getElementById("instruksi-layer").style.display = "none";
        instruksiDitutupManual = true;
      });

      
      // CSS untuk layout
      var style = document.createElement('style');
      style.textContent = `
        /* QGIS2WEB: layout map */
        #map {
          position:absolute;
          top:70px;
          left:260px;
          right:0;
          bottom:25px;
          transition:right 0.25s ease;
        }
        
        /* Panel info kebuka → map bergeser kiri */
        body.panel-open #map {
          right:260px;
        }
        
        /* Instruksi posisi awal */
        #instruksi-layer {
          transition:left 0.25s ease;
          left:calc(260px + (100% - 260px)/2);
        }
        
        /* Instruksi saat panel-info kebuka */
        body.panel-open #instruksi-layer {
          left:calc(260px + (100% - 260px - 260px)/2);
        }
        
        /* Header Custom */
        #custom-header {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 73px;
          background: #e8f2fa;
          color: white;
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0 20px;
          z-index: 1000;
          box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .header-left {
          display: flex;
          align-items: center;
          gap: 15px;
        }
        
        #header-logo {
          height: 60px;
          width: auto;
        }
        
        .header-title h1 {
          margin: 0;
          font-size: 18px;
          font-weight: 600;
        }
        
        .header-right h2 {
          margin: 0;
          font-size: 16px;
          font-weight: 500;
          opacity: 0.9;
        }
        
        /* Sidebar */
        #sidebar {
          position: absolute;
          top: 72px;
          left: 0;
          width: 260px;
          bottom: 25px;
          background: white;
          padding: 15px;
          overflow-y: auto;
          z-index: 1000;
          box-shadow: 2px 0 5px rgba(0,0,0,0.1);
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .section-title {
          display: flex;
          align-items: center;
          gap: 8px;
          margin: 5px 0 10px 0;
          font-weight: 600;
          color: #000000;
          font-size: 14px;
        }
        
        .section-title img {
          width: 16px;
          height: 16px;
        }
        
        #sidebar label {
          display: flex;
          align-items: center;
          margin: 8px 0;
          cursor: pointer;
          font-size: 13px;
          color: #333;
        }
        
        #sidebar input[type="checkbox"] {
          margin-right: 8px;
        }
        
        /* Legenda Style */
        .legend-box {
          background: #f8f9fa;
          border: 1px solid #dee2e6;
          border-radius: 6px;
          padding: 10px;
          font-size: 12px;
        }
        
        .legend-title-inside {
          font-weight: 600;
          margin-bottom: 8px;
          color: #2c3e50;
          font-size: 12px;
        }
        
        .legend-item {
          display: flex;
          align-items: center;
          margin-bottom: 6px;
        }
        
        .legend-color {
          display: inline-block;
          width: 20px;
          height: 12px;
          margin-right: 8px;
          border: 1px solid #666;
        }
        
        .legend-circle {
          display: inline-block;
          margin-right: 8px;
        }
        
        /* Panel Info Header */
        .panel-info-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 15px;
          padding-bottom: 10px;
          border-bottom: 2px solid #2a5298;
        }
        
        .panel-info-title {
          font-weight: 600;
          color: #2a5298;
          font-size: 16px;
        }
        
        .panel-info-close {
          border: none;
          background: transparent;
          font-size: 24px;
          cursor: pointer;
          color: #666;
          line-height: 1;
          padding: 0;
          width: 24px;
          height: 24px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        
        .panel-info-close:hover {
          color: #333;
        }
        
        /* Info Card Style */
        .info-card {
          margin-bottom: 16px;
          padding: 12px;
          background: #f8f9fa;
          border-radius: 6px;
          border-left: 4px solid #2a5298;
        }
        
        .info-card-title {
          font-weight: 600;
          margin-bottom: 8px;
          color: #2c3e50;
        }
        
        .info-table {
          width: 100%;
          border-collapse: collapse;
        }
        
        .info-table td {
          padding: 4px 0;
        }
        
        .info-table .label {
          color: #555;
          font-size: 12px;
        }
        
        .info-table .colon {
          width: 10px;
          text-align: center;
          color: #555;
        }
        
        .info-table .value {
          font-weight: 500;
          color: #333;
        }
        
        .info-desc {
          font-size: 11px;
          color: #666;
          margin-top: 8px;
          line-height: 1.4;
        }
        
        /* Layer Control Custom Styling */
        .leaflet-control-layers {
          border-radius: 4px;
          background: rgba(255, 255, 255, 0.9);
          box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .leaflet-control-layers-toggle {
          background-image: url('images/layer-switch.png');
          background-size: 22px 22px;
          background-position: center;
          width: 30px;
          height: 30px;
        }
        
        .leaflet-control-layers-expanded {
          padding: 6px 10px;
          font-size: 12px;
          max-width: 200px;
        }
        
        .leaflet-control-layers-list {
          max-height: 250px;
          overflow-y: auto;
        }
        
        .leaflet-control-layers label {
          margin: 4px 0;
          display: block;
          cursor: pointer;
        }
        
        .leaflet-control-layers label:hover {
          background: #f0f0f0;
        }
        
        /* Footer adjustment saat panel info terbuka */
        body.panel-open #data-source-footer {
          right: 260px;
        }
      `;
      document.head.appendChild(style);

      // Set bounds awal
      bounds_group.addLayer(layer_JumlahDestinasiWisata_1);
      bounds_group.addLayer(layer_Aksesibilitas_2);
      setBounds();
    </script>
  </body>
</html>